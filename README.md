# Web Inspector for Claude Code

> **é¡¹ç›®ç®€ä»‹**ï¼šæµè§ˆå™¨ç«¯å…ƒç´ é€‰æ‹©å™¨ï¼Œé€‰ä¸­ç½‘é¡µå…ƒç´ å¹¶é€šè¿‡ WebSocket å‘é€åˆ° Claude Code CLI

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ Bridge æœåŠ¡å™¨

```bash
cd bridge
./start-test.sh
```

æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼š

```bash
cd bridge
node server.js
```

**å¯é€‰å‚æ•°**ï¼š
- `--port <ç«¯å£å·>` - æŒ‡å®š WebSocket ç«¯å£ï¼ˆé»˜è®¤ 51765ï¼‰
- `--clipboard` - åŒæ—¶å°†è¾“å‡ºå¤åˆ¶åˆ°å‰ªè´´æ¿
- `--format json|markdown` - è¾“å‡ºæ ¼å¼ï¼ˆé»˜è®¤ markdownï¼‰

**ç¤ºä¾‹**ï¼š
```bash
node server.js --port 9999 --clipboard
```

---

### 2. å®‰è£…æ²¹çŒ´è„šæœ¬

1. ç¡®ä¿æµè§ˆå™¨å·²å®‰è£… [Tampermonkey](https://www.tampermonkey.net/) æ‰©å±•
2. æ‰“å¼€æ–‡ä»¶ `src/web-inspector.user.js`
3. å°†è„šæœ¬å†…å®¹å¤åˆ¶åˆ° Tampermonkey çš„æ–°è„šæœ¬ä¸­å¹¶ä¿å­˜
4. åˆ·æ–°ä»»æ„ç½‘é¡µ

---

### 3. ä½¿ç”¨ Web Inspector

1. æ‰“å¼€ä»»æ„ç½‘é¡µï¼ˆæ¨èï¼š[GitHub](https://github.com)ï¼‰
2. ç‚¹å‡» Tampermonkey èœå• â†’ **"Web Inspector (ç‚¹å‡»å¯ç”¨)"**
3. é¡µé¢åˆ·æ–°åï¼Œå³ä¸‹è§’å‡ºç°ç´«è‰²æ‚¬æµ®æŒ‰é’®
4. ç‚¹å‡»æŒ‰é’®æ¿€æ´»é€‰æ‹©å™¨ï¼ˆæŒ‰é’®å˜ç»¿å¹¶æ—‹è½¬ 45Â°ï¼‰
5. é¼ æ ‡æ‚¬åœåœ¨é¡µé¢å…ƒç´ ä¸Šï¼Œå‡ºç°ç´«è‰²é«˜äº®æ¡†
6. ç‚¹å‡»å…ƒç´ å®Œæˆé€‰æ‹©
7. Bridge æœåŠ¡å™¨çš„ stdout è¾“å‡ºå…ƒç´ ä¿¡æ¯ï¼ˆMarkdown æ ¼å¼ï¼‰

---

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
WebInspector/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ web-inspector.user.js   # æ²¹çŒ´è„šæœ¬ï¼ˆæµè§ˆå™¨ç«¯ï¼‰
â”œâ”€â”€ bridge/
â”‚   â”œâ”€â”€ server.js                # WebSocket æ¡¥æ¥æœåŠ¡å™¨
â”‚   â”œâ”€â”€ package.json             # Node.js ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ start-test.sh            # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ bridge.pid               # è¿è¡Œæ—¶ PID æ–‡ä»¶
â”œâ”€â”€ openspec/
â”‚   â”œâ”€â”€ specs/                   # æŠ€æœ¯è§„èŒƒæ–‡æ¡£
â”‚   â””â”€â”€ changes/                 # å˜æ›´è®°å½•å’Œä»»åŠ¡è§„åˆ’
â””â”€â”€ README.md                    # æœ¬æ–‡ä»¶
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### æµè§ˆå™¨ç«¯ï¼ˆæ²¹çŒ´è„šæœ¬ï¼‰

- âœ… **å…ƒç´ é€‰æ‹©å™¨**ï¼šæ•è·é˜¶æ®µäº‹ä»¶ç›‘å¬ï¼Œæ”¯æŒ Shadow DOM
- âœ… **æ•°æ®é‡‡é›†å™¨**ï¼šç”Ÿæˆ CSS é€‰æ‹©å™¨/XPathã€é‡‡é›†å±æ€§/æ ·å¼/HTML
- âœ… **WebSocket é€šä¿¡**ï¼šè‡ªåŠ¨è¿æ¥/æ–­çº¿é‡è¿/æŒ‡æ•°é€€é¿ç­–ç•¥
- âœ… **Ghost UI**ï¼šæ‚¬æµ®æŒ‰é’® + ä¿¡æ¯é¢æ¿ï¼ˆShadow DOM éš”ç¦»ï¼‰
- âœ… **æŒä¹…åŒ–é…ç½®**ï¼šå¯ç”¨çŠ¶æ€ + è‡ªå®šä¹‰ç«¯å£

### æœåŠ¡å™¨ç«¯ï¼ˆBridgeï¼‰

- âœ… **WebSocket æœåŠ¡å™¨**ï¼šç«¯å£å ç”¨è‡ªåŠ¨ +1 é‡è¯•
- âœ… **PID æ–‡ä»¶é”**ï¼šå¯åŠ¨å‰ä¼˜é›…ç»ˆæ­¢æ—§è¿›ç¨‹
- âœ… **æ ¼å¼åŒ–è¾“å‡º**ï¼šMarkdown / JSON
- âœ… **å‰ªè´´æ¿æ”¯æŒ**ï¼šmacOS `pbcopy`
- âœ… **ç®¡é“é›†æˆ**ï¼šå¯ç›´æ¥é€šè¿‡ç®¡é“å‘é€ç»™ Claude Code

---

## ğŸ”§ é…ç½®é€‰é¡¹

### æ²¹çŒ´è„šæœ¬é…ç½®

**é€šè¿‡èœå•é…ç½®**ï¼ˆæ— éœ€ç¼–è¾‘ä»£ç ï¼‰ï¼š
1. ç‚¹å‡» Tampermonkey èœå•
2. é€‰æ‹© "è®¾ç½® WebSocket ç«¯å£"
3. è¾“å…¥ç«¯å£å·ï¼ˆ1-65535ï¼‰

**ä»£ç çº§é…ç½®**ï¼ˆ`src/web-inspector.user.js`ï¼‰ï¼š
```javascript
const Config = {
  WS_URL: 'ws://localhost:51765',  // WebSocket åœ°å€
  MAX_RETRIES: 5,                  // æœ€å¤§é‡è¿æ¬¡æ•°
  RETRY_INTERVAL: 3000,            // é‡è¿é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  MAX_DATA_SIZE: 5120,             // JSON æ•°æ®å¤§å°é™åˆ¶ï¼ˆå­—ç¬¦ï¼‰
  TEXT_LIMITS: {                   // æ–‡æœ¬å­—æ®µæˆªæ–­é™åˆ¶
    textContent: 500,
    innerHTML: 2000,
    outerHTML: 3000
  }
};
```

### Bridge æœåŠ¡å™¨é…ç½®

**é€šè¿‡å‘½ä»¤è¡Œå‚æ•°**ï¼š
```bash
node server.js --port 9999 --clipboard --format json
```

**ä»£ç çº§é…ç½®**ï¼ˆ`bridge/server.js`ï¼‰ï¼š
```javascript
const DEFAULT_PORT = 51765;      // é»˜è®¤ç«¯å£
const PID_FILE = 'bridge.pid';   // PID æ–‡ä»¶è·¯å¾„
```

---

## ğŸ“š æŠ€æœ¯è§„èŒƒ

è¯¦ç»†çš„æŠ€æœ¯è§„èŒƒå’Œè®¾è®¡æ–‡æ¡£è¯·å‚è€ƒï¼š

- **éœ€æ±‚è§„æ ¼ä¹¦**ï¼š`openspec/changes/web-inspector-tampermonkey/proposal.md`
- **ç³»ç»Ÿè®¾è®¡**ï¼š`openspec/changes/web-inspector-tampermonkey/design.md`
- **ä»»åŠ¡è§„åˆ’**ï¼š`openspec/changes/web-inspector-tampermonkey/tasks.md`
- **æµ‹è¯•æŒ‡å—**ï¼š`openspec/changes/web-inspector-tampermonkey/PHASE8_TEST_GUIDE.md`

---

## ğŸ§ª éªŒæ”¶æµ‹è¯•

Phase 8 çš„å®Œæ•´éªŒæ”¶æµ‹è¯•åŒ…å« 14 é¡¹æµ‹è¯•ç”¨ä¾‹ï¼š

### åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆ3 é¡¹ï¼‰
- GitHub æŒ‰é’®é€‰æ‹©
- ç™¾åº¦æœç´¢é“¾æ¥é€‰æ‹©
- SPA é¡µé¢æµ‹è¯•

### è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼ˆ3 é¡¹ï¼‰
- Shadow DOM ç»„ä»¶
- iframe é¡µé¢
- CSP ä¸¥æ ¼ç½‘ç«™

### æ€§èƒ½æµ‹è¯•ï¼ˆ3 é¡¹ï¼‰
- å¤§é‡ DOM å…ƒç´ é¡µé¢ï¼ˆ< 16ms å“åº”ï¼‰
- å¤§å…ƒç´  outerHTML é™åˆ¶ï¼ˆâ‰¤ 5KBï¼‰
- WebSocket æ–­è¿é‡è¿ï¼ˆ5 æ¬¡æŒ‡æ•°é€€é¿ï¼‰

### é›†æˆæµ‹è¯•ï¼ˆ5 é¡¹ï¼‰
- æ ‡å‡†å¯åŠ¨æµç¨‹
- å‰ªè´´æ¿æ¨¡å¼
- Claude Code CLI é›†æˆ
- ç«¯å£å†²çªè‡ªåŠ¨åˆ‡æ¢
- PID æ–‡ä»¶é”æœºåˆ¶

**è¯¦ç»†æµ‹è¯•æ­¥éª¤**ï¼šè¯·å‚è€ƒ `openspec/changes/web-inspector-tampermonkey/PHASE8_TEST_GUIDE.md`

---

## ğŸ”— ä¸ Claude Code é›†æˆ

### æ–¹å¼ 1: ç®¡é“è¾“å‡º

```bash
cd bridge
node server.js | claude -p "åˆ†æè¿™ä¸ªç½‘é¡µå…ƒç´ "
```

åœ¨æµè§ˆå™¨ä¸­é€‰ä¸­å…ƒç´ åï¼ŒClaude Code ä¼šè‡ªåŠ¨æ¥æ”¶å¹¶åˆ†æå…ƒç´ æ•°æ®ã€‚

---

### æ–¹å¼ 2: å‰ªè´´æ¿æ¨¡å¼

```bash
cd bridge
node server.js --clipboard
```

é€‰ä¸­å…ƒç´ åï¼Œæ•°æ®ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œç„¶åå¯ä»¥åœ¨ Claude Code ä¸­æ‰‹åŠ¨ç²˜è´´ã€‚

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Ghost æŒ‰é’®ä¸æ˜¾ç¤ºï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Tampermonkey èœå•ä¸­æ˜¯å¦å·²å¯ç”¨ Web Inspector
2. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—
3. åˆ·æ–°é¡µé¢å¹¶é‡æ–°å¯ç”¨

---

### Q2: WebSocket è¿æ¥å¤±è´¥ï¼ˆçŠ¶æ€ç‚¹é—ªçƒï¼‰ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
```bash
# 1. ç¡®è®¤ Bridge æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
lsof -i :51765

# 2. æ£€æŸ¥ç«¯å£é…ç½®æ˜¯å¦ä¸€è‡´
# æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ:
console.log(Config.WS_URL);
```

---

### Q3: é€‰ä¸­å…ƒç´ åæ²¡æœ‰è¾“å‡ºï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Bridge æœåŠ¡å™¨çš„ stdout/stderr æ˜¯å¦æœ‰é”™è¯¯
2. WebSocket è¿æ¥æ˜¯å¦å·²å»ºç«‹ï¼ˆçŠ¶æ€ç‚¹åº”ä¸ºç»¿è‰²ï¼‰
3. åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•æ•°æ®é‡‡é›†ï¼š
```javascript
const el = document.querySelector('button');
const data = Collector.collect(el);
console.log(JSON.stringify(data).length);  // åº”è¯¥ <= 5120
```

---

### Q4: ç«¯å£è¢«å ç”¨æ— æ³•å¯åŠ¨ï¼Ÿ

**A**: Bridge ä¼šè‡ªåŠ¨å°è¯•ç«¯å£ +1 é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰ï¼š
- é»˜è®¤ç«¯å£ï¼š51765
- é‡è¯•ç«¯å£ï¼š51766, 51767

å¦‚æœæ‰€æœ‰ç«¯å£éƒ½è¢«å ç”¨ï¼Œè¯·æ‰‹åŠ¨æŒ‡å®šç«¯å£ï¼š
```bash
node server.js --port 52000
```

ç„¶ååœ¨æ²¹çŒ´è„šæœ¬ä¸­é€šè¿‡èœå• "è®¾ç½® WebSocket ç«¯å£" æ›´æ–°ç«¯å£å·ã€‚

---

### Q5: å¦‚ä½•æ¸…ç†å¼‚å¸¸é€€å‡ºçš„è¿›ç¨‹ï¼Ÿ

**A**: Bridge ä½¿ç”¨ PID æ–‡ä»¶é”æœºåˆ¶ï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼š
```bash
# æ‰‹åŠ¨æ¸…ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
rm bridge/bridge.pid
pkill -f "node.*server.js"
```

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºä¸ªäººå­¦ä¹ é¡¹ç›®ï¼Œä»…ä¾›å‚è€ƒã€‚

---

## ğŸ‘¤ ä½œè€…

**Atlas.oi**
é¡¹ç›®åˆ›å»ºæ—¥æœŸï¼š2026-02-08

---

## ğŸ‰ è‡´è°¢

æ„Ÿè°¢ [Claude Code CLI](https://claude.ai) æä¾›çš„å¼ºå¤§å¼€å‘å·¥å…·é“¾ï¼

---

**Enjoy coding!** (ï¿£â–½ï¿£)ï¼
