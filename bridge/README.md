# Web Inspector Bridge - ä½¿ç”¨è¯´æ˜

> æ™ºèƒ½å¤š CLI å®ä¾‹è·¯ç”±ç³»ç»Ÿï¼Œæ”¯æŒ Ghostty å¤šçª—å£ç„¦ç‚¹æ£€æµ‹

## ğŸ¯ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æµè§ˆå™¨ç”¨æˆ·è„šæœ¬                        â”‚
â”‚  (Tampermonkey: web-inspector.user.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ WebSocket (51765)
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Bridge æ™ºèƒ½è·¯ç”±å±‚                  â”‚
â”‚  - ç„¦ç‚¹æ£€æµ‹ (AppleScript)                   â”‚
â”‚  - å¿ƒè·³æ£€æµ‹ (3ç§’æ´»è·ƒ)                       â”‚
â”‚  - è‡ªåŠ¨é™çº§                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚          â”‚              â”‚
       â†“          â†“              â†“
   CLI-A        CLI-B          CLI-C
  (é¡¹ç›®A)      (é¡¹ç›®B)        (é¡¹ç›®C)
   TTY:         TTY:           TTY:
/dev/ttys001  /dev/ttys002  /dev/ttys003
```

## ğŸ“¦ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `server.js` | Bridge æœåŠ¡å™¨ï¼ˆåŒç«¯å£æ¶æ„ï¼‰ |
| `client.js` | CLI å®¢æˆ·ç«¯è¿æ¥å™¨ï¼ˆè‡ªåŠ¨å¯åŠ¨ Bridge + å¿ƒè·³ï¼‰ |
| `start-client.sh` | CLI å®¢æˆ·ç«¯å¯åŠ¨è„šæœ¬ï¼ˆæ‰‹åŠ¨æ§åˆ¶ï¼‰ |
| `install-autostart.sh` | è‡ªåŠ¨å¯åŠ¨å®‰è£…è„šæœ¬ï¼ˆé›†æˆåˆ° shellï¼‰ |
| `start-test.sh` | æµ‹è¯•å¯åŠ¨è„šæœ¬ï¼ˆPhase 8 é—ç•™ï¼‰ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1ï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆæ¨èæµ‹è¯•ï¼‰

åœ¨æ¯ä¸ª Claude Code CLI çª—å£ä¸­è¿è¡Œï¼š

```bash
cd ~/CodeCoding/Code/è‡ªç ”é¡¹ç›®/WebInspector/bridge
./start-client.sh --background
```

### æ–¹å¼ 2ï¼šè‡ªåŠ¨å¯åŠ¨ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰

å®‰è£…ä¸€æ¬¡ï¼Œä»¥åæ¯æ¬¡æ‰“å¼€ç»ˆç«¯è‡ªåŠ¨å¯åŠ¨ï¼š

```bash
cd ~/CodeCoding/Code/è‡ªç ”é¡¹ç›®/WebInspector/bridge
./install-autostart.sh install
source ~/.zshrc  # æˆ– ~/.bashrc
```

å¸è½½è‡ªåŠ¨å¯åŠ¨ï¼š

```bash
./install-autostart.sh uninstall
```

### æ–¹å¼ 3ï¼šç›´æ¥è¿è¡Œï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰

é€‚åˆè°ƒè¯•ï¼š

```bash
node client.js
```

## ğŸ”§ å·¥ä½œæµç¨‹

### 1. å¯åŠ¨å¤šä¸ª Claude Code CLI

```bash
# çª—å£ Aï¼ˆé¡¹ç›® Aï¼‰
cd ~/project-a
claude code

# çª—å£ Bï¼ˆé¡¹ç›® Bï¼‰
cd ~/project-b
claude code

# çª—å£ Cï¼ˆé¡¹ç›® Cï¼‰
cd ~/project-c
claude code
```

### 2. CLI å®¢æˆ·ç«¯è‡ªåŠ¨è¿è¡Œ

- å¦‚æœå·²å®‰è£…è‡ªåŠ¨å¯åŠ¨ï¼ŒCLI å®¢æˆ·ç«¯ä¼šåœ¨æ‰“å¼€ç»ˆç«¯æ—¶è‡ªåŠ¨åå°è¿è¡Œ
- å¦‚æœæ‰‹åŠ¨å¯åŠ¨ï¼Œè¿è¡Œ `./start-client.sh --background`

### 3. CLI å®¢æˆ·ç«¯è‡ªåŠ¨å¤„ç†

1. **æ£€æŸ¥ Bridge**ï¼šæ£€æµ‹ Bridge æ˜¯å¦è¿è¡Œ
2. **å¯åŠ¨ Bridge**ï¼šå¦‚æœæœªè¿è¡Œï¼Œè‡ªåŠ¨åå°å¯åŠ¨ Bridge
3. **è¿æ¥ Bridge**ï¼šè¿æ¥åˆ° `ws://localhost:51766`
4. **ä¸ŠæŠ¥ TTY**ï¼šä¸ŠæŠ¥é¡¹ç›®è·¯å¾„ã€TTYã€PID
5. **ç»´æŒå¿ƒè·³**ï¼šæ¯ 5 ç§’å‘é€å¿ƒè·³

### 4. æµè§ˆå™¨é€‰æ‹©å…ƒç´ 

1. ç”¨æˆ·ç‚¹å‡» Ghostty çª—å£ Aï¼ˆæ¿€æ´»ï¼‰
2. ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­é€‰æ‹©å…ƒç´ 
3. ç”¨æˆ·è„šæœ¬å‘é€æ¶ˆæ¯åˆ° Bridge (51765)
4. Bridge æ™ºèƒ½è·¯ç”±ï¼š
   - ğŸ¯ ç„¦ç‚¹æ£€æµ‹ï¼šåŒ¹é…é¡¹ç›® A çš„ TTY
   - â±ï¸ å¿ƒè·³æ£€æµ‹ï¼š3 ç§’å†…æ´»è·ƒçš„ CLI
   - ğŸ”„ å…œåº•ç­–ç•¥ï¼šæœ€è¿‘æ´»è·ƒçš„ CLI
5. Bridge è½¬å‘æ¶ˆæ¯åˆ°é¡¹ç›® A çš„ CLI
6. é¡¹ç›® A çš„ Claude Code æ”¶åˆ°å…ƒç´ æ•°æ® âœ…

### 5. åˆ‡æ¢çª—å£

1. ç”¨æˆ·ç‚¹å‡» Ghostty çª—å£ Cï¼ˆæ¿€æ´»ï¼‰
2. ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­é€‰æ‹©å…ƒç´ 
3. Bridge é‡æ–°è·¯ç”±åˆ°é¡¹ç›® C âœ…

## ğŸ“Š è·¯ç”±ç­–ç•¥

### ä¼˜å…ˆçº§ï¼ˆä¸‰çº§é™çº§ï¼‰

1. **ç³»ç»Ÿç„¦ç‚¹æ£€æµ‹ï¼ˆæœ€å‡†ç¡®ï¼‰**
   - ä½¿ç”¨ AppleScript æ£€æµ‹å½“å‰æ¿€æ´»çš„ Ghostty çª—å£
   - åŒ¹é…çª—å£æ ‡é¢˜ä¸é¡¹ç›®è·¯å¾„æˆ– TTY
   - 500ms è¶…æ—¶ä¿æŠ¤

2. **å¿ƒè·³æ£€æµ‹ï¼ˆ3 ç§’å†…æ´»è·ƒï¼‰**
   - åŸºäºæœ€è¿‘å¿ƒè·³æ—¶é—´æˆ³æ’åº
   - é€‰æ‹©æœ€è¿‘æ´»è·ƒçš„ CLI

3. **å…œåº•ç­–ç•¥**
   - é€‰æ‹©æ‰€æœ‰ CLI ä¸­æœ€è¿‘æ´»è·ƒçš„
   - ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹ CLI å®¢æˆ·ç«¯çŠ¶æ€

```bash
./start-client.sh status
```

### åœæ­¢ CLI å®¢æˆ·ç«¯

```bash
./start-client.sh stop
```

### é‡å¯ CLI å®¢æˆ·ç«¯

```bash
./start-client.sh restart
```

### æŸ¥çœ‹æ—¥å¿—

```bash
tail -f bridge/client.log  # CLI å®¢æˆ·ç«¯æ—¥å¿—
tail -f bridge/bridge.log  # Bridge æœåŠ¡å™¨æ—¥å¿—
```

## ğŸ› æ•…éšœæ’æŸ¥

### Bridge æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :51765
lsof -i :51766

# æ‰‹åŠ¨å¯åŠ¨ Bridge
cd ~/CodeCoding/Code/è‡ªç ”é¡¹ç›®/WebInspector/bridge
node server.js
```

### CLI å®¢æˆ·ç«¯æ— æ³•è¿æ¥

```bash
# æ£€æŸ¥ Bridge çŠ¶æ€
ps aux | grep "node server.js"

# æ‰‹åŠ¨å¯åŠ¨ CLI å®¢æˆ·ç«¯ï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰
node client.js
```

### è·¯ç”±åˆ°é”™è¯¯çš„ CLI

```bash
# æ£€æŸ¥ç„¦ç‚¹æ£€æµ‹
osascript -e 'tell application "System Events" to get name of first application process whose frontmost is true'

# æ£€æŸ¥è®¢é˜…è€…åˆ—è¡¨ï¼ˆBridge æ—¥å¿—ï¼‰
tail -f bridge/bridge.log | grep "CLI æ³¨å†Œ"
```

## ğŸ¨ æ ¸å¿ƒç‰¹æ€§

âœ… **å®Œå…¨è‡ªåŠ¨åŒ–**ï¼šæ— éœ€æ‰‹åŠ¨å¯åŠ¨ï¼Œæ— éœ€é…ç½®
âœ… **æ™ºèƒ½è·¯ç”±**ï¼šè‡ªåŠ¨æ£€æµ‹æ¿€æ´»çª—å£ï¼Œé›¶ç”¨æˆ·å¹²é¢„
âœ… **å¥å£®æ€§é«˜**ï¼šBridge å´©æºƒè‡ªåŠ¨é‡å¯ï¼ŒCLI æ–­çº¿è‡ªåŠ¨é‡è¿
âœ… **ä¼˜é›…é™çº§**ï¼šç„¦ç‚¹æ£€æµ‹å¤±è´¥è‡ªåŠ¨é™çº§åˆ°å¿ƒè·³æ£€æµ‹
âœ… **é›¶ä¾µå…¥**ï¼šä¸å½±å“ç°æœ‰ Claude Code å·¥ä½œæµ

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### è‡ªåŠ¨é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼‰

- åˆå§‹å»¶è¿Ÿï¼š1 ç§’
- æœ€å¤§å»¶è¿Ÿï¼š30 ç§’
- ç­–ç•¥ï¼š1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s â†’ 30s

### å¿ƒè·³æœºåˆ¶

- é—´éš”ï¼š5 ç§’
- æ´»è·ƒé˜ˆå€¼ï¼š3 ç§’
- è¶…è¿‡ 3 ç§’æœªå¿ƒè·³è§†ä¸ºä¸æ´»è·ƒ

### ç„¦ç‚¹æ£€æµ‹

- æŠ€æœ¯ï¼šAppleScript + System Events
- è¶…æ—¶ï¼š500ms
- å¤±è´¥é™çº§ï¼šå¿ƒè·³æ£€æµ‹

## ğŸ”„ å¼€å‘è°ƒè¯•

### æµ‹è¯•å¤š CLI å®ä¾‹

```bash
# ç»ˆç«¯ 1
cd ~/project-a && node bridge/client.js

# ç»ˆç«¯ 2
cd ~/project-b && node bridge/client.js

# ç»ˆç«¯ 3
cd ~/project-c && node bridge/client.js
```

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# Bridge æœåŠ¡å™¨
node bridge/server.js

# CLI å®¢æˆ·ç«¯ï¼ˆçª—å£ Aï¼‰
node bridge/client.js
```

### æµ‹è¯•ç„¦ç‚¹è·¯ç”±

1. å¯åŠ¨ 3 ä¸ª CLI å®¢æˆ·ç«¯
2. åœ¨æµè§ˆå™¨ä¸­å®‰è£…æ²¹çŒ´è„šæœ¬
3. ç‚¹å‡»ä¸åŒçš„ Ghostty çª—å£
4. åœ¨æµè§ˆå™¨ä¸­é€‰æ‹©å…ƒç´ 
5. è§‚å¯Ÿå“ªä¸ª CLI æ”¶åˆ°æ¶ˆæ¯

## ğŸ“š æ›´å¤šä¿¡æ¯

- [Phase 8 æµ‹è¯•æŒ‡å—](../openspec/changes/web-inspector-tampermonkey/PHASE8_TEST_GUIDE.md)
- [å®æ–½æ€»ç»“](../openspec/changes/web-inspector-tampermonkey/IMPLEMENTATION_SUMMARY.md)

---

**ä½œè€…**: Atlas.oi
**æ—¥æœŸ**: 2026-02-08
